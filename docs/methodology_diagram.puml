@startuml SERS_Insight_Platform_Methodology

!define PRIMARY_COLOR #6366F1
!define SECONDARY_COLOR #06B6D4
!define ACCENT_COLOR #8B5CF6
!define SUCCESS_COLOR #10B981
!define WARNING_COLOR #F59E0B

skinparam backgroundColor #FAFAFA
skinparam defaultFontName Inter
skinparam defaultFontSize 11
skinparam shadowing true

skinparam rectangle {
    BackgroundColor white
    BorderColor #E2E8F0
    RoundCorner 15
}

skinparam component {
    BackgroundColor white
    BorderColor PRIMARY_COLOR
    RoundCorner 10
}

skinparam database {
    BackgroundColor #F1F5F9
    BorderColor #64748B
}

skinparam cloud {
    BackgroundColor #EEF2FF
    BorderColor ACCENT_COLOR
}

skinparam collections {
    BackgroundColor #ECFDF5
    BorderColor SUCCESS_COLOR
}

title <size:24><b>SERS-Insight Platform</b></size>\n<size:14>Surface-Enhanced Raman Spectroscopy Analysis Platform\nMethodology & Architecture Diagram</size>

'=====================================
' USER INTERFACE LAYER
'=====================================
rectangle "**USER INTERFACE LAYER** (Next.js 14 + TypeScript)" as UI_LAYER #EEF2FF {
    
    rectangle "Main Application Pages" as PAGES {
        component "ðŸ  **Home Page**\n(AI Chat Interface)" as HOME #E0E7FF
        component "ðŸ”¬ **LSPR Simulation Lab**\n(Physics-based Simulation)" as SIMULATE #E0E7FF
        component "ðŸ“Š **Peak Analyzer**\n(Baseline Correction)" as PEAK_ANALYZER #E0E7FF
        component "ðŸ“ˆ **Visualization Studio**\n(Interactive Charts)" as VISUALIZE #E0E7FF
        component "ðŸ”„ **Custom Workflows**\n(YAML-based Automation)" as WORKFLOWS #E0E7FF
    }
    
    rectangle "Reusable Components" as COMPONENTS {
        collections "**Layout Components**\nâ€¢ Sidebar Navigation\nâ€¢ Header\nâ€¢ MainLayout" as LAYOUT
        collections "**Chat Components**\nâ€¢ ChatContainer\nâ€¢ ChatMessage\nâ€¢ ChatInput" as CHAT_COMP
        collections "**Upload Components**\nâ€¢ FileUploadZone\nâ€¢ Drag & Drop" as UPLOAD_COMP
        collections "**UI Components**\nâ€¢ shadcn/ui Primitives\nâ€¢ Custom SVG Icons" as UI_COMP
    }
    
    rectangle "State Management" as STATE {
        component "ðŸ“¦ **Zustand Store**\nâ€¢ Session State\nâ€¢ UI State\nâ€¢ Data Context" as ZUSTAND #FEF3C7
    }
}

'=====================================
' API COMMUNICATION LAYER
'=====================================
rectangle "**API COMMUNICATION LAYER**" as API_LAYER #F0FDF4 {
    
    component "ðŸ”— **REST API Client**\n(Fetch/Axios)" as API_CLIENT #DCFCE7
    
    note right of API_CLIENT
        API Base URL: http://localhost:8000
        Endpoints:
        â€¢ POST /api/upload
        â€¢ POST /api/preprocess
        â€¢ POST /api/analyze
        â€¢ POST /api/simulate
        â€¢ POST /api/chat (streaming)
        â€¢ GET /api/workflows
        â€¢ GET /api/visualizations
    end note
}

'=====================================
' BACKEND API LAYER
'=====================================
rectangle "**BACKEND API LAYER** (FastAPI Python)" as BACKEND_LAYER #FEF2F2 {
    
    rectangle "API Routes" as ROUTES {
        component "ðŸ“¤ **Upload Router**\n/api/upload\n/api/datasets" as UPLOAD_ROUTE #FEE2E2
        component "âš™ï¸ **Preprocess Router**\n/api/preprocess\n/api/preprocess/options" as PREPROCESS_ROUTE #FEE2E2
        component "ðŸ”¬ **Analyze Router**\n/api/analyze\n/api/frameworks" as ANALYZE_ROUTE #FEE2E2
        component "âš¡ **Simulate Router**\n/api/simulate\n/api/simulate/materials" as SIMULATE_ROUTE #FEE2E2
        component "ðŸ’¬ **Chat Router**\n/api/chat\n/api/chat/stream\n/api/chat/models" as CHAT_ROUTE #FEE2E2
        component "ðŸ”„ **Workflows Router**\n/api/workflows" as WORKFLOWS_ROUTE #FEE2E2
        component "ðŸ“Š **Visualizations Router**\n/api/visualizations" as VIZ_ROUTE #FEE2E2
    }
    
    rectangle "Core Services" as CORE_SERVICES {
        component "ðŸ¤– **AI Service**\n(OpenRouter Integration)\nâ€¢ Multi-model Support\nâ€¢ Streaming\nâ€¢ Fallback Logic" as AI_SERVICE #FECDD3
        component "âš™ï¸ **Config Service**\nâ€¢ Environment Settings\nâ€¢ CORS Configuration\nâ€¢ Directory Paths" as CONFIG_SERVICE #FECDD3
    }
}

'=====================================
' PROCESSING ENGINE LAYER
'=====================================
rectangle "**PROCESSING ENGINE LAYER**" as PROCESSING_LAYER #FDF4FF {
    
    rectangle "Data Processing Pipeline" as DATA_PIPELINE {
        component "ðŸ“¥ **File Parser**\nâ€¢ CSV/TXT/XLSX/JSON\nâ€¢ Auto-delimiter Detection\nâ€¢ Metadata Extraction" as FILE_PARSER #F3E8FF
        
        component "ðŸ”§ **Preprocessing Engine**\nâ€¢ Baseline Correction (ALS)\nâ€¢ Savitzky-Golay Smoothing\nâ€¢ Normalization\nâ€¢ Peak Detection" as PREPROCESS_ENGINE #F3E8FF
    }
    
    rectangle "Analysis Frameworks" as ANALYSIS_FRAMEWORKS {
        component "ðŸ§ª **Molecule Detection**\nâ€¢ Reference Peak Library\n  (R6G, CV, NB, MB)\nâ€¢ Peak Matching\nâ€¢ Confidence Scoring" as MOLECULE_DETECTION #E9D5FF
        
        component "ðŸ§¬ **Biomolecule Classification**\nâ€¢ PCA Dimensionality Reduction\nâ€¢ SVM Classifier\nâ€¢ Random Forest Classifier\nâ€¢ Cross-validation" as BIO_CLASSIFICATION #E9D5FF
        
        component "ðŸ¦  **Pathogen Detection**\nâ€¢ 1D CNN Architecture\nâ€¢ Data Augmentation\nâ€¢ Ensemble Methods" as PATHOGEN_DETECTION #E9D5FF
        
        component "ðŸ”€ **Spectral Unmixing**\nâ€¢ NMF (Non-negative Matrix)\nâ€¢ ICA (Independent Component)\nâ€¢ Component Separation" as SPECTRAL_UNMIXING #E9D5FF
    }
    
    rectangle "LSPR Simulation Engine" as LSPR_ENGINE {
        component "âš›ï¸ **Drude-Lorentz Model**\nâ€¢ Dielectric Function Îµ(Ï‰)\nâ€¢ Material Parameters\n  (Ag: Ï‰p=9.17eV, Î³=0.021eV)\n  (Au: Ï‰p=9.03eV, Î³=0.072eV)" as DRUDE_MODEL #DDD6FE
        
        component "ðŸ”® **Mie Theory Calculator**\nâ€¢ Extinction Cross-section\nâ€¢ LSPR Peak Position\nâ€¢ Shape Correction\nâ€¢ Enhancement Factor" as MIE_THEORY #DDD6FE
        
        component "ðŸ’¡ **SERS Enhancement**\nâ€¢ EF = |E_local/Eâ‚€|â´\nâ€¢ Hotspot Factor\nâ€¢ Resonance Matching" as SERS_ENHANCEMENT #DDD6FE
    }
}

'=====================================
' EXTERNAL SERVICES LAYER
'=====================================
cloud "**EXTERNAL AI SERVICES**" as EXTERNAL_AI #EEF2FF {
    component "ðŸ¦™ **Llama 3.3 70B**\n(Meta - Free Tier)" as LLAMA_MODEL #C7D2FE
    component "ðŸ¤– **Qwen 2.5 72B**\n(Alibaba - Free Tier)" as QWEN_MODEL #C7D2FE
    component "âœ¨ **Gemini 2.0 Flash**\n(Google - Free Tier)" as GEMINI_MODEL #C7D2FE
    
    component "ðŸ”€ **OpenRouter API**\n(Multi-model Gateway)" as OPENROUTER #A5B4FC
}

'=====================================
' DATA STORAGE LAYER
'=====================================
database "**DATA STORAGE**" as STORAGE {
    collections "ðŸ“ Uploads Directory\n(Raw Data Files)" as UPLOADS_DIR
    collections "ðŸ“Š Results Directory\n(Processed Outputs)" as RESULTS_DIR
    collections "ðŸ§  Models Directory\n(Trained ML Models)" as MODELS_DIR
    collections "ðŸ“· Static Files\n(Visualizations)" as STATIC_DIR
}

'=====================================
' SCIENTIFIC LIBRARIES
'=====================================
rectangle "**SCIENTIFIC COMPUTING STACK**" as SCI_STACK #FFFBEB {
    component "ðŸ”¢ **NumPy**\nNumerical Computing" as NUMPY #FEF3C7
    component "ðŸ“ˆ **SciPy**\nâ€¢ Signal Processing\nâ€¢ Optimization\nâ€¢ Statistics" as SCIPY #FEF3C7
    component "ðŸ¼ **Pandas**\nData Manipulation" as PANDAS #FEF3C7
    component "ðŸ¤– **scikit-learn**\nâ€¢ PCA\nâ€¢ SVM/RF Classifiers\nâ€¢ Cross-validation" as SKLEARN #FEF3C7
}

'=====================================
' CONNECTIONS - UI to API
'=====================================
HOME -down-> API_CLIENT : "Chat Messages\n(SSE Streaming)"
SIMULATE -down-> API_CLIENT : "Simulation\nParameters"
PEAK_ANALYZER -down-> API_CLIENT : "Spectrum Data\n& Preprocessing"
VISUALIZE -down-> API_CLIENT : "Visualization\nRequests"
WORKFLOWS -down-> API_CLIENT : "Workflow\nExecution"

LAYOUT --> PAGES
CHAT_COMP --> HOME
UPLOAD_COMP --> HOME
UPLOAD_COMP --> PEAK_ANALYZER
UI_COMP --> PAGES
ZUSTAND --> PAGES

'=====================================
' CONNECTIONS - API Layer to Backend
'=====================================
API_CLIENT -down-> UPLOAD_ROUTE
API_CLIENT -down-> PREPROCESS_ROUTE
API_CLIENT -down-> ANALYZE_ROUTE
API_CLIENT -down-> SIMULATE_ROUTE
API_CLIENT -down-> CHAT_ROUTE
API_CLIENT -down-> WORKFLOWS_ROUTE
API_CLIENT -down-> VIZ_ROUTE

'=====================================
' CONNECTIONS - Backend to Processing
'=====================================
UPLOAD_ROUTE -down-> FILE_PARSER
PREPROCESS_ROUTE -down-> PREPROCESS_ENGINE
ANALYZE_ROUTE -down-> MOLECULE_DETECTION
ANALYZE_ROUTE -down-> BIO_CLASSIFICATION
ANALYZE_ROUTE -down-> PATHOGEN_DETECTION
ANALYZE_ROUTE -down-> SPECTRAL_UNMIXING
SIMULATE_ROUTE -down-> DRUDE_MODEL
SIMULATE_ROUTE -down-> MIE_THEORY

DRUDE_MODEL --> MIE_THEORY
MIE_THEORY --> SERS_ENHANCEMENT

'=====================================
' CONNECTIONS - AI Service
'=====================================
CHAT_ROUTE -right-> AI_SERVICE
AI_SERVICE -down-> OPENROUTER
OPENROUTER --> LLAMA_MODEL
OPENROUTER --> QWEN_MODEL
OPENROUTER --> GEMINI_MODEL

'=====================================
' CONNECTIONS - Storage
'=====================================
FILE_PARSER -down-> UPLOADS_DIR
PREPROCESS_ENGINE -down-> RESULTS_DIR
ANALYSIS_FRAMEWORKS -down-> MODELS_DIR
VIZ_ROUTE -down-> STATIC_DIR

'=====================================
' CONNECTIONS - Scientific Libraries
'=====================================
PREPROCESS_ENGINE -right-> NUMPY
PREPROCESS_ENGINE -right-> SCIPY
FILE_PARSER -right-> PANDAS
ANALYSIS_FRAMEWORKS -right-> SKLEARN
LSPR_ENGINE -right-> NUMPY

'=====================================
' LEGEND
'=====================================
legend bottom
    |= Color |= Layer |
    | <#EEF2FF> | Frontend (Next.js) |
    | <#F0FDF4> | API Communication |
    | <#FEF2F2> | Backend (FastAPI) |
    | <#FDF4FF> | Processing Engines |
    | <#FFFBEB> | Scientific Libraries |
    | <#EEF2FF> (cloud) | External AI Services |
endlegend

footer \n<size:10>SERS-Insight Platform v1.0.0 | MIT License | Architecture Methodology Diagram</size>

@enduml
